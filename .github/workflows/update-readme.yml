name: Update README with Dynamic Content
on:
  schedule:
    # S'exÃ©cute tous les jours Ã  2h du matin (UTC)
    - cron: '0 2 * * *'
  workflow_dispatch: # Permet le dÃ©clenchement manuel

permissions:
  contents: write

jobs:
  update-blog-posts:
    name: Update blog posts section
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Update blog posts
        uses: gautamkrishnar/blog-post-workflow@master
        with:
          feed_list: |
            https://dev.to/feed/votre-username
            https://medium.com/feed/@votre-username
            https://votre-blog.com/feed.xml
          max_post_count: 5
          commit_message: "ğŸ“ Updated with latest blog posts"
          date_format: "dd mmm yyyy"
          template: "- [$title]($url) - $date"
          
  update-events:
    name: Update events section
    runs-on: ubuntu-latest
    needs: update-blog-posts # S'exÃ©cute aprÃ¨s la mise Ã  jour des articles
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          
      - name: Fetch latest changes
        run: git pull
        
      - name: Fetch events from API
        id: fetch-events
        run: |
          # Exemple de rÃ©cupÃ©ration d'Ã©vÃ©nements depuis une API
          # Remplacez par votre propre API
          echo "<!-- EVENTS:START -->" > events.tmp
          
          # Simulation d'Ã©vÃ©nements (remplacez par un vrai appel API)
          cat << EOF >> events.tmp
          - **[15 Nov]** ğŸ¤ ConfÃ©rence Tech Leaders - Paris
          - **[22 Nov]** ğŸ’» Workshop Docker & Kubernetes - En ligne
          - **[5 Dec]** ğŸ‰ SoirÃ©e de fin d'annÃ©e - Lyon
          - **[12 Dec]** ğŸ“š Formation React AvancÃ©e - Marseille
          EOF
          
          echo "<!-- EVENTS:END -->" >> events.tmp
          
      - name: Update README with events
        run: |
          # Remplace la section des Ã©vÃ©nements dans le README
          sed -i '/<!-- EVENTS:START -->/,/<!-- EVENTS:END -->/d' README.md
          sed -i '/## ğŸ“… Ã‰vÃ©nements Ã  Venir/r events.tmp' README.md
          rm events.tmp
          
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ğŸ“… Updated events list"
            git push
          fi
          
  update-stats:
    name: Update statistics
    runs-on: ubuntu-latest
    needs: update-events
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          
      - name: Fetch latest changes
        run: git pull
        
      - name: Generate statistics
        run: |
          # Exemple de gÃ©nÃ©ration de statistiques
          # Remplacez par vos propres mÃ©triques
          
          CURRENT_DATE=$(date +"%d/%m/%Y")
          
          # CrÃ©er un fichier de statistiques temporaire
          cat << EOF > stats.tmp
          <!-- STATS:START -->
          - ğŸ“Š DerniÃ¨re mise Ã  jour: ${CURRENT_DATE}
          - ğŸ‘¥ Contributeurs actifs: 42
          - ğŸš€ DÃ©ploiements cette semaine: 15
          - âœ… Tests rÃ©ussis: 98.5%
          - ğŸ“¦ Packages publiÃ©s: 12
          <!-- STATS:END -->
          EOF
          
      - name: Update README with stats
        run: |
          # VÃ©rifie si la section STATS existe, sinon l'ajoute
          if ! grep -q "<!-- STATS:START -->" README.md; then
            echo -e "\n## ğŸ“ˆ Statistiques en Temps RÃ©el\n\n<!-- STATS:START -->\n<!-- STATS:END -->" >> README.md
          fi
          
          # Remplace la section des statistiques
          sed -i '/<!-- STATS:START -->/,/<!-- STATS:END -->/d' README.md
          sed -i '/## ğŸ“ˆ Statistiques en Temps RÃ©el/r stats.tmp' README.md
          rm stats.tmp
          
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ğŸ“ˆ Updated statistics"
            git push
          fi